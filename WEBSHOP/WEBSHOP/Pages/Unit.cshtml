@page
@model WEBSHOP.Pages.UnitModel


<div id="MainDiv">
<div class="text-center">
    <label id="MainLabel" class="font-weight-normal fs-1">
        Units @if (User.IsInRole(UserStatus.Admin.ToString()))
        {
            <i class="bi bi-plus-circle link-success" data-createpartial="@Url.PageLink("/Unit","ToCreate")"></i>
        }
    </label>
</div>
<br />
<br />

<div id="unitList" class="row" style="justify-content:center">
    @foreach (var item in Model.UnitList)
    {
        <div class="col-lg-4" style="height:300px">
            <div class=card>
                <div class="card-header text-center">
                    <label class="card-title fs-3">@item.Title</label>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col">
                            <div class="row text-center">
                                <label class="card-text">Address: @item.Address</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer">
                    <div class=row>
                        <div class="col">
                            <button class="btn btn-outline-warning" data-url="@Url.Page("Unit","ToEdit",new UnitViewModel
                        {
                            Id = item.Id,
                            Title = item.Title,
                            Address = item.Address
                        })">
                                <i class="bi bi-pencil-square"></i> Edit
                            </button>
                        </div>
                        <div class="col">
                            <button type="button" class="btn btn-outline-danger" asp-page="Unit" asp-page-handler="Delete" asp-route-Id="@item.Id"
                                data-delConfPart="/Unit?Id=@item.Id&handler=ToDelete">
                                <i class="bi bi-trash3"></i> Delete
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    }
</div>
</div>
@section Scripts{
<script>
    $(document).on('click','.btn-outline-warning',function (e) {
            $('#MainDiv').append('<div id="ModalHere"></div>');
            var ModalEditElement = $('#ModalHere');
            var url = $(this).data('url');
            $.get(url).done(function (data) {
                ModalEditElement.html(data);
                ModalEditElement.find('.modal').modal('show');
            })


        $(document).on('click','button[data-bs-dismiss *= "modal"]',function(e){
                ModalEditElement.find('.modal').modal('hide');
                ModalEditElement.html(null);
                ModalEditElement.remove();
            })

        ModalEditElement.on('click','#SaveBtn', function(e) {
            var actionUrl = ModalEditElement.find('#UnitEditForm').attr('action');
            var data = ModalEditElement.find('#UnitEditForm').serialize();
            ModalEditElement.off('click', '#SaveBtn');
            $.ajax({
                type: 'POST',
                url: actionUrl,
                data: data,
            }).done(function(e){
                        var newBody = $('.modal-body', e);
                    ModalEditElement.find('.modal-body').replaceWith(newBody);
                    var isValid = newBody.find('[name="IsValid"]').val() == 'True';
                    if (isValid) {
                        $.get('Unit').done(function(e){
                            var newbody = $('#unitList', e);
                            $(document).find('#unitList').replaceWith(newbody);
                            ModalEditElement.find('.modal').modal('hide');
                            $('#MainDiv').find('#ModalHere').remove();
                        })
                    }
                    })
              })
        })
        $(document).on('click', '.bi-plus-circle', function (e) {
        $('#MainDiv').append('<div id="ModalHere"></div>');
        var ModalCreateElement = $('#ModalHere');
        var url = $(this).data('createpartial');
        $.get(url).done(function (data) {
            ModalCreateElement.html(data);
            ModalCreateElement.find('.modal').modal('show');
        })
        ModalCreateElement.on('click', 'button[data-bs-dismiss *= "modal"]', function (e) {
            ModalCreateElement.find('.modal').modal('hide');
            $('#MainDiv').find('#ModalHere').remove();
        });

        ModalCreateElement.on('click', '#CreateBtn', function (e) {
            var dataToSend = ModalCreateElement.find('#UnitCreateForm').serialize();
            var crtUrl = ModalCreateElement.find('#UnitCreateForm').attr('action');
            $.ajax({
                type: "POST",
                url: crtUrl,
                data: dataToSend
            }).done(function (e) {
                var newBody = $('.modal-body', e);
                ModalCreateElement.find('.modal-body').replaceWith(newBody);
                var isValid = newBody.find('[name="IsValid"]').val() == 'True';
                if (isValid) {
                    $.get('Unit').done(function (e) {
                        var newbody = $('#unitList', e);
                        $(document).find('#unitList').replaceWith(newbody);
                        ModalCreateElement.find('.modal').modal('hide');
                        $('#ModalHere').remove();
                    })
                }
            })
        })
    })
</script>
}